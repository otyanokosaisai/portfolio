---
import Section from "../Section.astro";
import { Icon } from "astro-icon/components";

import { projects } from "@cv";

---
<Section className={Astro.props.className} title="Projects">
  <div class="grid grid-cols-1 gap-3 md:grid-cols-2 print:flex print:flex-col">
    {
      projects?.map(
        ({ url_enc, description, highlights, name, isActive, stack }) => {
          return (
              <div
                role="contentinfo"
                class={`project-card grid-span-1 group relative flex min-h-80 flex-col overflow-hidden rounded-md p-5 shadow-sm ring-1 transition-all duration-250 ease-in-out ${
                  isActive
                    ? "bg-skin-button-muted/50 ring-skin-muted sm:hover:ring-2 sm:hover:ring-skin-hue sm:hover:bg-skin-muted"
                    : "bg-gray-300/40 ring-gray-400 cursor-not-allowed opacity-60 sm:hover:ring-skin-hue sm:hover:bg-skin-muted"
                }`}
                data-url-enc={url_enc ?? ""}
              >
              <div class="relative z-10 flex items-center justify-between space-x-[10px]">
                <div class="flex items-center gap-2">
                  <Icon data-ccursor="lift" name="mdi:folder-outline" class="size-4" />
                  <div class="flex items-center gap-[6px]">
                    <span class="text-lg">{name}</span>
                  </div>
                </div>
              </div>

              <!-- Description -->
              <p data-ccursor="noPadding" class="relative z-10 py-3 text-sm text-skin-base">
                {description}
              </p>

              <!-- Highlights -->
              <ul class="z-10 mt-1 text-sm">
                {highlights?.map((highlight) => (
                  <li data-ccursor class="w-max">{highlight}</li>
                ))}
              </ul>

              <!-- Stack Icons -->
              <ul class="flex print:hidden flex-wrap gap-2 mt-4" aria-label="Technologies used">
                {stack &&
                  Object.entries(stack).map(([label, icon]) => (
                    <li
                      data-ccursor="lift"
                      class="border-skin-hue/60 text-skin-hue flex gap-1 items-center border border-solid rounded-md px-2 py-0.5 text-xs backdrop-blur-sm group/stack"
                    >
                      {icon ? (
                        <span class="flex gap-1">
                          <Icon name={icon} width={16} height={16} />
                          <span class="group-hover/stack:text-skin-hue transition-all duration-200">{label}</span>
                        </span>
                      ) : (
                        <span>{label}</span>
                      )}
                    </li>
                  ))}
              </ul>
            </div>
          );
        }
      )
    }
  </div>
</Section>

<script>
  import { Fancybox } from "@fancyapps/ui";
  import { deobf } from "@/utils/deobf";

  Fancybox.bind('[data-fancybox="projects"]', { hideScrollbar: false });

  document.querySelectorAll(".project-card").forEach(card => {
    const enc = card.getAttribute("data-url-enc");
    if (!enc) return;
    card.addEventListener("click", () => {
      const url = deobf(enc);
      if (url) window.open(url, "_blank");
    });
  });
</script>

<style>
  ul {
    @apply ml-4 list-disc space-y-1;
    li {
      @apply text-skin-muted marker:text-skin-hue;
    }
  }

  footer {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    font-size: 0.6rem;
  }

  footer span {
    border-radius: 6px;
    background: #eee;
    color: #444;
    font-size: 0.6rem;
    font-weight: 500;
    padding: 0.2rem 0.6rem;
  }
</style>
